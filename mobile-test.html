<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mobile Catalog - New Architecture Test</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Montserrat', Arial, sans-serif;
            background: #f5f5f0;
            overflow: hidden;
        }
        
        #catalogContainer {
            width: 100vw;
            height: 100vh;
            position: relative;
        }
        
        #catalogSvg {
            width: 100%;
            height: 100%;
            background: radial-gradient(circle, #ffffff 0%, #f0f0f0 100%);
        }
        
        .debug-info {
            position: fixed;
            top: 10px;
            left: 10px;
            background: rgba(0,0,0,0.8);
            color: white;
            padding: 10px;
            border-radius: 4px;
            font-size: 12px;
            z-index: 1000;
            max-width: 300px;
        }
        
        .debug-info h4 {
            margin: 0 0 5px 0;
            color: #4CAF50;
        }
        
        .debug-info p {
            margin: 2px 0;
        }
        
        .navigation-controls {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            z-index: 1000;
        }
        
        .nav-button {
            background: #4a90e2;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.2s ease;
        }
        
        .nav-button:hover {
            background: #357abd;
        }
        
        .nav-button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        
        .breadcrumb {
            position: fixed;
            top: 10px;
            right: 10px;
            background: rgba(255,255,255,0.9);
            padding: 10px;
            border-radius: 4px;
            font-size: 14px;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div id="catalogContainer">
        <svg id="catalogSvg" viewBox="0 0 400 400">
            <!-- SVG content will be generated by the app -->
        </svg>
    </div>
    
    <div class="debug-info" id="debugInfo">
        <h4>Mobile Catalog - New Architecture</h4>
        <p>Status: <span id="status">Initializing...</span></p>
        <p>Level: <span id="currentLevel">-</span></p>
        <p>Items: <span id="itemCount">-</span></p>
        <p>Rotation: <span id="rotation">0°</span></p>
        <p>Manufacturers: <span id="manufacturerCount">-</span></p>
    </div>
    
    <div class="breadcrumb" id="breadcrumb">
        Home
    </div>
    
    <div class="navigation-controls">
        <button class="nav-button" id="backButton" onclick="navigateBack()" disabled>← Back</button>
        <button class="nav-button" id="resetButton" onclick="resetApp()">Reset</button>
        <button class="nav-button" id="statsButton" onclick="showStats()">Stats</button>
    </div>

    <script type="module">
        import { initMobileCatalog, mobileCatalogApp } from './mobile/mobile-app.js';
        
        let app = null;
        let updateInterval = null;
        
        // Initialize the app
        async function init() {
            try {
                document.getElementById('status').textContent = 'Loading...';
                
                await initMobileCatalog();
                app = window.mobileCatalogApp;
                
                if (app) {
                    document.getElementById('status').textContent = 'Initialized';
                    
                    // Set up event listeners
                    setupEventListeners();
                    
                    // Start debug info updates
                    startDebugUpdates();
                    
                } else {
                    throw new Error('App not initialized');
                }
                
            } catch (error) {
                console.error('Failed to initialize:', error);
                document.getElementById('status').textContent = 'Error: ' + error.message;
            }
        }
        
        function setupEventListeners() {
            if (!app) return;
            
            // Listen for state changes
            app.stateManager.addEventListener('navigationChanged', updateUI);
            app.stateManager.addEventListener('rotationChanged', updateRotation);
            app.stateManager.addEventListener('breadcrumbChanged', updateBreadcrumb);
        }
        
        function updateUI(event) {
            const { currentState } = event.detail;
            const context = app.stateManager.getCurrentContext();
            
            document.getElementById('currentLevel').textContent = currentState.currentLevel;
            document.getElementById('itemCount').textContent = context.itemCount;
            document.getElementById('backButton').disabled = !context.canNavigateBack;
        }
        
        function updateRotation(event) {
            const { rotation } = event.detail;
            const degrees = (rotation * 180 / Math.PI).toFixed(1);
            document.getElementById('rotation').textContent = degrees + '°';
        }
        
        function updateBreadcrumb(event) {
            const { breadcrumb } = event.detail;
            const breadcrumbEl = document.getElementById('breadcrumb');
            
            if (breadcrumb.length === 0) {
                breadcrumbEl.textContent = 'Manufacturers';
            } else {
                breadcrumbEl.textContent = breadcrumb.map(item => item.label).join(' → ');
            }
        }
        
        function startDebugUpdates() {
            updateInterval = setInterval(() => {
                if (!app) return;
                
                try {
                    const stats = app.getStats();
                    const summary = app.dataManager.getDataSummary();
                    
                    document.getElementById('manufacturerCount').textContent = summary.manufacturers;
                    
                } catch (error) {
                    console.error('Error updating debug info:', error);
                }
            }, 1000);
        }
        
        // Global functions for buttons
        window.navigateBack = function() {
            if (app) {
                app.navigateToParent();
            }
        };
        
        window.resetApp = function() {
            if (app) {
                app.reset();
            }
        };
        
        window.showStats = function() {
            if (app) {
                const stats = app.getStats();
                const analytics = app.stateManager.getAnalytics();
                
                alert(`
Mobile Catalog Stats:
• Level: ${stats.currentLevel}
• Items: ${stats.currentItems}
• Navigation Count: ${stats.navigationCount}
• Session Duration: ${(analytics.sessionDuration / 1000).toFixed(1)}s
• Rotation: ${(stats.rotation * 180 / Math.PI).toFixed(1)}°
• Rendering: ${stats.renderingEnabled ? 'Enabled' : 'Disabled'}
• Interaction: ${stats.interactionEnabled ? 'Enabled' : 'Disabled'}
                `.trim());
            }
        };
        
        // Start initialization
        init();
    </script>
</body>
</html>